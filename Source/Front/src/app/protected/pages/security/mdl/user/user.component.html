<div class="divMainModal" style="padding: 24px; max-width: 550px; margin: 0 auto;">

    <div class="row">
        <div class="col-md-12">
            <h1 style="margin-bottom: 20px; font-weight: 500;">
                {{ (idUser) ? 'Editar' : 'Nuevo' }} {{title}}
            </h1>
        </div>
    </div>

    <button mat-icon-button style="position: absolute; top: 10px; right: 10px;" (click)="close()">
        <mat-icon>close</mat-icon>
    </button>

    <div class="row">
        <div class="col-md-12">

            <div class="row">
                <div class="col-md-12">
                    <mat-form-field fxLayout.xs="column" style="width: 100%;">
                        <mat-label>Nombre:</mat-label>
                        <input matInput type="text" [(ngModel)]="userForm.name">
                    </mat-form-field>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <mat-form-field fxLayout.xs="column" style="width: 100%;">
                        <mat-label>Usuario:</mat-label>
                        <input matInput type="text" [(ngModel)]="userForm.userName">
                    </mat-form-field>
                </div>
            </div>

            <div class="row" *ngIf="idUser == 0">
                <div class="col-md-12">
                    <mat-form-field fxLayout.xs="column" style="width: 100%;">
                        <mat-label>Contraseña:</mat-label>
                        <input matInput [type]="hidePwd3 ? 'password' : 'text'" [(ngModel)]="userForm.pwd">
                        <mat-icon matSuffix (click)="hidePwd3 = !hidePwd3">{{hidePwd3 ? 'visibility_off' :
                            'visibility'}}</mat-icon>
                    </mat-form-field>
                    <div class="alert alert-info" role="alert"
                        style="text-align: left !important; font-size: 12px; padding: 8px; margin-top: -10px;">
                        La contraseña debe cumplir con los siguientes requisitos:
                        <ul style="margin-bottom: 5px;">
                            <li>Tener al menos 6 caracteres</li>
                            <li>Incluir al menos un número</li>
                            <li>Incluir al menos una letra mayúscula</li>
                            <li>Incluir al menos una letra minúscula</li>
                            <li>Incluir al menos un carácter especial (por ejemplo: -_.,$^!%*?&)</li>
                        </ul>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-md-12">
                    <mat-checkbox class="example-margin" [(ngModel)]="userForm.active" disabled>Activo</mat-checkbox>
                </div>
            </div>

            <div class="row" style="margin-top: 15px;">
                <div class="col-md-12">
                    <div style="float: left;">
                        <button mat-raised-button color="primary" type="submit" class="marginRight10px"
                            (click)="fn_saveUser()" [disabled]="!validateUserForm()">Guardar</button>

                        <button mat-raised-button type="button" (click)="close()">Cancelar</button>

                    </div>
                </div>
            </div>

        </div>
    </div>



    <div *ngIf="idUser > 0">
        <h1 class="">
            <mat-icon class="" style="font-size: 30px;">assignment_ind</mat-icon>
            Roles del usuario
        </h1>

        <div class="row" style="margin-top: 10px;">
            <div class="col-md-12">

                <div class="row">

                    <div class="col-md-10">
                        <mat-label>Rol: </mat-label>
                        <mat-form-field style="width: 100%;" (click)="cbxSearchRol()">
                            <input type="text" id="cbxRol" placeholder="Selecciona un rol para asignar..."
                                aria-label="Number" matInput [(ngModel)]="addRoleForm.text" [matAutocomplete]="cbxRol"
                                (input)="cbxSearchRol()">
                            <button *ngIf="addRoleForm.text" matSuffix mat-icon-button aria-label="Clear"
                                (click)="cbxRolClear()">
                                <mat-icon>close</mat-icon>
                            </button>
                            <mat-autocomplete autoActiveFirstOption #cbxRol="matAutocomplete"
                                (optionSelected)="cbxSelectedOptionRol( $event )">
                                <mat-option *ngFor="let role of cbxRoles" [value]="role">
                                    {{ role.text }}
                                </mat-option>

                                <mat-option value="" *ngIf="cbxRoles.length == 0 && addRoleForm.text">
                                    No se encontró nada...
                                </mat-option>

                            </mat-autocomplete>
                        </mat-form-field>
                    </div>

                    <div class="col-md-2">
                        <div>
                            <button mat-raised-button color="primary" type="submit" style="margin-top: 30px;"
                                class="marginRight10px" [disabled]="addRoleForm.idRol == 0"
                                (click)="fn_insertRolByIdUser()">Agregar rol</button>

                        </div>
                    </div>

                </div>

            </div>
        </div>

        <div class="row top20px">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <th class="textAlingLeft padding-th">Rol</th>
                            <th class="textAlingCenter padding-th">Creado</th>
                            <th class="textAlingCenter padding-th">Acciones</th>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of rolesByUserList">
                                <td class="textAlingLeft">{{ item.name }}</td>
                                <td class="textAlingCenter">{{ item.createDate | date:'dd-MM-yyyy' }}</td>
                                <td class="textAlingCenter">
                                    <div style="width: 100px;">

                                        <span class="material-icons manitaSobre colorRed"
                                            matTooltip="Eliminar rol del usuario"
                                            (click)="fn_deleteRolByIdUser( item.idRol )">
                                            delete_outline
                                        </span>

                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- <div *ngIf="idUser > 0 && hasPermissionAction('users_changePwd')"> -->
    <div *ngIf="idUser > 0">
        <h1>
            <mat-icon class="" style="font-size: 30px;">lock</mat-icon>
            Cambio de contraseña
        </h1>
        <div class="row">
            <div class="col-md-12">

                <div class="textAlingCenter">

                    <br>

                    <form action="" autocomplete="off" [formGroup]="changePwdForm">

                        <div class="row">
                            <div class="col-md-12">
                                <mat-form-field fxLayout.xs="column" style="width: 100%;">
                                    <mat-label>Contraseña:</mat-label>
                                    <input matInput [type]="hidePwd ? 'password' : 'text'" formControlName="pwd">
                                    <mat-icon matSuffix (click)="hidePwd = !hidePwd">{{hidePwd ? 'visibility_off' :
                                        'visibility'}}</mat-icon>
                                </mat-form-field>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <mat-form-field fxLayout.xs="column" style="width: 100%;">
                                    <mat-label>Verificar contraseña:</mat-label>
                                    <input matInput [type]="hidePwd2 ? 'password' : 'text'" formControlName="pwd2">
                                    <mat-icon matSuffix (click)="hidePwd2 = !hidePwd2">{{hidePwd2 ? 'visibility_off' :
                                        'visibility'}}</mat-icon>
                                </mat-form-field>
                            </div>
                        </div>

                        <div class="alert alert-info" role="alert" style="text-align: left !important;">
                            La contraseña debe cumplir con los siguientes requisitos:
                            <ul>
                                <li>Tener al menos 6 caracteres</li>
                                <li>Incluir al menos un número</li>
                                <li>Incluir al menos una letra mayúscula</li>
                                <li>Incluir al menos una letra minúscula</li>
                                <li>Incluir al menos un carácter especial (por ejemplo: -_.,$^!%*?&)</li>
                            </ul>
                        </div>

                        <div class="row top10px">
                            <div class="col-md-12">
                                <div style="float: left;">
                                    <button mat-raised-button color="primary" type="submit" class="marginRight10px"
                                        [disabled]="changePwdForm.invalid"
                                        (click)="fn_changePassword()">Guardar</button>

                                </div>
                            </div>
                        </div>

                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<app-spinner [hidden]="!bShowSpinner"></app-spinner>